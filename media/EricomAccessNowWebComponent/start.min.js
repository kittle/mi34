$(function(){function n(j){$(document.body).on({"dragenter.rdp":cancelEvent,"dragover.rdp":cancelEvent,"drop.rdp":function(f){cancelEvent(f);var a=f.originalEvent.dataTransfer.files;if(a&&a.length){f=new FileReader;f.onloadend=function(){var b=new Data(this.result);if(b.has("full address")){var h=b.get("websocket address")||prompt("AccessNow Server address",b.get("full address").split(":")[0]);if(h!==null){b.set("websocket address",h||"localhost");j(b)}}else dialog.notify("'"+a[0].name+"' is not a valid .rdp or .blaze file",
true)};f.onerror=function(){dialog.notify("Error reading file")};f.readAsText(a[0])}}})}$("button, input:submit").button();var o=dialog.modal("#about",{options:{minWidth:500}});$('button[id="showAbout"]').click(o.open);$(window).load(setImmediate.bind(window,function(){function j(){if(p.children("option:selected").text().match(/^(?:Chinese|Japanese|Korean)/)){m=k.is(":checked");k.attr({checked:"checked",disabled:"disabled"})}else k.is(":disabled")&&k.removeAttr("disabled").if_(!m).removeAttr("checked")}
function f(c){return c.find("#encryption").attr("checked",is.HTTPS).end().find('option[data-lang^="'+(navigator.userLanguage||navigator.language||"en-us").toLowerCase()+'"]').each(function(){this.selected=true;return false}).end().setValues(globals)}var a=$(".settings"),b=$("#advanced");n(function(c){globals.isManaged=true;a.trigger("submit",[c])});var h=function(c){return function(){c.attr("disabled",usernameContainsDomain(this.value))}}(a.find("#domain"));f(a).enableDisable().find("#username").keyup(h).each(h);
var m,p=$("#keyboard_locale"),k=$("#convert_unicode_to_scancode");j();a.find("#keyboard_locale").change(j).end().submit(function(c,l){a.off("submit").submit(false);$(document.body).off(".rdp");if(!globals.isManaged){a.getValues("id",localS);a.find("#remember").is(":checked")||localS.removeItem("password");b.getValues("id",localS)}CI(clientID());var d={};if(!globals.isManaged){a.getValues("name",d);b.getValues("name",d);if(d.remoteapplicationmode!==1){delete d["alternate shell"];delete d["shell working directory"]}}var g=
!globals.isManaged||externals.resolution?a.find("#resolution").val():"browser";g=="screen"&&$("#canvas").enterFullScreen();setImmediate(function(){g=screenSize(g);d.desktopwidth=g[0];d.desktopheight=g[1];if(d.desktopheight){var i={GUID:localS.GUID,address:a.find("#address").val().trim(),encryption:a.find("#encryption").is(":checked"),configuration:d,data:l};if(b.find("#use_gateway").is(":checked"))i.gateway=b.find("#gateway_address").val();var e=d["full address"]||i.address;if(isString(globals.restrictHost)&&
globals.restrictHost.toArray().some(function(q){return this.match(RegExp("^"+q.replace(/\./g,"\\.").replace(/\*/g,".*")+"(?:[:]|$)","i"))},e))dialog.restart({html:"RDP Host address '"+e+"' not allowed",critical:true,options:{autoOpen:true}});else{$(".top,.container").hide();session(i)}}else setTimeout(session,1E3)});return false}).on("reset",setImmediate.bind(window,function(){var c=localS.GUID;localS.clear();localS.GUID=c;globals=calcGlobals();f(a);r(globals);return false}));var r=function(c){function l(e){b.find("form").resetForm().if_(!!audio.Context).find("#audiomode").removeAttr("disabled").if_(!!audioWebAPI.Context).children(":selected").removeAttr("selected").end().children(":first").attr("selected",
"selected").end().end().end().end().if_(cookies.get("ESG_GWID")).find("#use_gateway").attr("checked",true).end().find("#gateway_address").val(location.host).end().end().setValues(c=e)}var d=function(e){return function(){e.val(this.checked?"http,https":"nothing")}}(b.find('input[name="RDP_RedirectSchemes"]')),g=function(e){return function(){e.attr("required",$("#use_gateway").is(":checked"))}}(a.find("#username,#password"));g();var i=dialog.modal(b,{options:{minWidth:500,create:function(){l(c);b.enableDisable().dialog("widget").keypress(function(e){if(e.which===
$.ui.keyCode.ENTER){$(this).find("button:first").click();return false}})},open:function(){b.setValues(c).enableDisable(false).find("#redirect").each(d).end().getValues("id",c)},buttons:{OK:function(){g();b.find("#redirect").each(d).end().dialog("close").getValues("id",c)},Cancel:function(){b.dialog("close")}}}});$('button[id="showAdvanced"]').click(i.open);return l}(globals);a.hidden(globals.hiddenFields).if_(globals.autostart).submit().else_().reveal().if_(globals.message).append('<table><tr valign="middle"><td style="width:40px"><img src="resources/info.png" alt="" width="40" height="40" /></td><td>'+
globals.message+"</td></tr></table>")}));globals.autostart||$(".outer").css("visibility","visible")});
